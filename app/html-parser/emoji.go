package html_parser

import (
	"fmt"
	"regexp"
	"unicode/utf8"
)

type emojiRange struct {
	s string
	e string
}

var emojiCodes = []emojiRange{
	{s: "00A9"},
	{s: "00AE"},
	{s: "203C"},
	{s: "2049"},
	{s: "2122"},
	{s: "2139"},
	{"2194", "2199"},
	{"21A9", "21AA"},
	{"231A", "231B"},
	{s: "2328"},
	{s: "23CF"},
	{"23E9", "23F3"},
	{"23F8", "23FA"},
	{s: "24C2"},
	{"25AA", "25AB"},
	{s: "25B6"},
	{s: "25C0"},
	{"25FB", "25FE"},
	{"2600", "2604"},
	{s: "260E"},
	{s: "2611"},
	{"2614", "2615"},
	{s: "2618"},
	{s: "261D"},
	{s: "2620"},
	{"2622", "2623"},
	{s: "2626"},
	{s: "262A"},
	{"262E", "262F"},
	{"2638", "263A"},
	{s: "2640"},
	{s: "2642"},
	{"2648", "2653"},
	{s: "2660"},
	{s: "2663"},
	{"2665", "2666"},
	{s: "2668"},
	{s: "267B"},
	{s: "267F"},
	{"2692", "2697"},
	{s: "2699"},
	{"269B", "269C"},
	{"26A0", "26A1"},
	{"26AA", "26AB"},
	{"26B0", "26B1"},
	{"26BD", "26BF"},
	{"26C4", "26C5"},
	{s: "26C8"},
	{"26CE", "26CF"},
	{s: "26D1"},
	{"26D3", "26D4"},
	{"26E9", "26EA"},
	{"26F0", "26F5"},
	{"26F7", "26FA"},
	{s: "26FD"},
	{s: "2702"},
	{s: "2705"},
	{"2708", "270D"},
	{s: "270F"},
	{s: "2712"},
	{s: "2714"},
	{s: "2716"},
	{s: "271D"},
	{s: "2721"},
	{s: "2728"},
	{"2733", "2734"},
	{s: "2744"},
	{s: "2747"},
	{s: "274C"},
	{s: "274E"},
	{"2753", "2755"},
	{s: "2757"},
	{"2763", "2764"},
	{"2795", "2797"},
	{s: "27A1"},
	{s: "27B0"},
	{s: "27BF"},
	{"2934", "2935"},
	{"2B05", "2B07"},
	{"2B1B", "2B1C"},
	{s: "2B50"},
	{s: "2B55"},
	{s: "3030"},
	{s: "303D"},
	{s: "3297"},
	{s: "3299"},
	{s: "1F004"},
	{s: "1F0CF"},
	{"1F170", "1F171"},
	{"1F17E", "1F17F"},
	{s: "1F18E"},
	{"1F191", "1F19A"},
	{"1F1E6", "1F1FF"},
	{"1F201", "1F202"},
	{s: "1F21A"},
	{s: "1F22F"},
	{"1F232", "1F23A"},
	{"1F250", "1F251"},
	{"1F300", "1F321"},
	{"1F324", "1F393"},
	{"1F396", "1F397"},
	{"1F399", "1F39B"},
	{"1F39E", "1F3F0"},
	{"1F39E", "1F3F0"},
	{"1F3F3", "1F3F5"},
	{"1F3F7", "1F4FD"},
	{"1F4FF", "1F53D"},
	{"1F549", "1F54E"},
	{"1F550", "1F567"},
	{"1F56F", "1F570"},
	{"1F573", "1F57A"},
	{s: "1F587"},
	{"1F58A", "1F58D"},
	{"1F58A", "1F58D"},
	{s: "1F590"},
	{"1F595", "1F596"},
	{"1F5A4", "1F5A5"},
	{s: "1F5A8"},
	{"1F5B1", "1F5B2"},
	{s: "1F5BC"},
	{"1F5C2", "1F5C4"},
	{"1F5D1", "1F5D3"},
	{"1F5DC", "1F5DE"},
	{s: "1F5E1"},
	{s: "1F5E3"},
	{s: "1F5E8"},
	{s: "1F5EF"},
	{s: "1F5F3"},
	{"1F5FA", "1F64F"},
	{"1F680", "1F6C5"},
	{"1F6CB", "1F6D2"},
	{"1F6E0", "1F6E5"},
	{s: "1F6E9"},
	{"1F6EB", "1F6EC"},
	{s: "1F6F0"},
	{"1F6F3", "1F6F8"},
	{"1F910", "1F93A"},
	{"1F93C", "1F93E"},
	{"1F940", "1F945"},
	{"1F947", "1F94C"},
	{"1F950", "1F96B"},
	{"1F980", "1F997"},
	{s: "1F9C0"},
	{"1F9D0", "1F9E6"},
}

func init() {
	str := "["
	for _, rng := range emojiCodes {
		str = str + "\\x{" + rng.s + "}"
		if rng.e != "" {
			str = str + "-\\x{" + rng.e + "}"
		}
	}
	str = str + "]"
	rx = regexp.MustCompile(str)
}

var rx *regexp.Regexp

type emojiParser struct {
	*regexp.Regexp
}

func NewEmojiParser() *emojiParser {
	return &emojiParser{rx}
}

func (p *emojiParser) ToHtmlEntities(str string) string {
	return p.ReplaceAllStringFunc(str, func(s string) string {
		r, _ := utf8.DecodeRuneInString(s)
		html := fmt.Sprintf(`&#x%X;`, r)
		return html
	})
}
